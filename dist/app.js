(()=>{"use strict";var e={752:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(986)),i=n(r(860)),s=n(r(186)),a=n(r(966)),d=n(r(437)),u=n(r(582)),l=r(142),f=r(394);(0,l.config)();const c=(0,i.default)(),h=process.env.PORT||3e3;(0,s.default)(),c.use(o.default.json()),c.get("/",((e,t)=>{t.send("Hello World!")})),c.use("/api/auth",a.default),c.use("/api/user",d.default),c.use("/api/admin",u.default),c.use(f.notFound),c.use(f.errorHandler),c.listen(h,(()=>{console.log(`Example app listening on port ${h}`)}))},186:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(185));(0,r(142).config)();const s=process.env.DB_URI||"";t.default=()=>n(void 0,void 0,void 0,(function*(){i.default.set("strictQuery",!1);try{yield i.default.connect(s),console.log("Connected to MongoDB")}catch(e){console.log(e),process.exit()}}))},7:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateToken=void 0;const o=n(r(344));(0,r(142).config)();const i=process.env.JWT_SECRET||"mySecret";t.generateToken=e=>o.default.sign({id:e},i,{expiresIn:"3d"})},558:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateProfile=t.deleteProfile=t.getProfile=void 0;const i=o(r(909)),s=o(r(776)),a=(0,s.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){const{id:r}=e.params;if(!r)throw new Error("Plz provide userId");try{const e=yield i.default.findById(r).select("-password");if(!e)throw new Error("User doesn't exist");t.send(e)}catch(e){throw new Error(e)}}))));t.getProfile=a;const d=(0,s.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){const{id:r}=e.params,{firstName:n,lastName:o,email:s,mobile:a}=e.body;try{const e=[];if(s&&((yield i.default.findOne({_id:r,email:s}))?e.push("Email already in use!"):(yield i.default.findOne({_id:{$ne:r},email:s}))&&e.push("Email already exists!")),a&&((yield i.default.findOne({_id:r,mobile:a}))?e.push("Mobile already in use!"):(yield i.default.findOne({_id:{$ne:r},mobile:a}))&&e.push("Mobile no. already exists!")),e.length>0)throw new Error(e.join(", "));const d=Object.fromEntries(Object.entries({firstName:n,lastName:o,email:s,mobile:a}).map((([e,t])=>[e,t||null]))),u=yield i.default.findOneAndUpdate({_id:r},d,{new:!0}).select("-password");if(!u)throw new Error("User doesn't exist");t.send(u)}catch(e){throw new Error(e)}}))));t.updateProfile=d;const u=(0,s.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){const{id:r}=e.params;if(!r)throw new Error("Plz provide userId");try{const e=yield i.default.findByIdAndDelete(r).select("-password");if(!e)throw new Error("User doesn't exist");t.send(e)}catch(e){throw new Error(e)}}))));t.deleteProfile=u},739:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loginUser=t.createUser=void 0;const s=i(r(909)),a=i(r(776)),d=r(7),u=(0,a.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){try{const{email:r,firstName:n,mobile:o,password:i,role:a,lastName:d}=e.body;if(a&&"user"!==a)throw new Error("You don't have to premission to create a admin user");if(yield s.default.findOne({email:r}))throw new Error("User already exists!");{const e=yield s.default.create({firstName:n,lastName:d,password:i,mobile:o,email:r});t.json(e)}}catch(e){throw new Error(e)}}))));t.createUser=u;const l=(0,a.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){const{email:r,password:n}=e.body,i=yield s.default.findOne({email:r});if(!i)throw new Error("User doesn't exist!");if(!(yield i.isPasswordMatched(n)))throw new Error("Incorrect Password!");{const e=i.toJSON(),{password:r}=e,n=o(e,["password"]);t.json(Object.assign(Object.assign({},n),{token:(0,d.generateToken)(i._id)}))}}))));t.loginUser=l},438:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateProfile=t.getProfile=void 0;const i=o(r(909)),s=o(r(776)),a=o(r(396)),d=(0,s.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){if(!e.user)throw new Error("Unauthorized request!");const{_id:r}=e.user;if((0,a.default)(r),!r)throw new Error("Plz provide userId");try{const e=yield i.default.findById(r).select("-password");if(!e)throw new Error("User doesn't exist");t.send(e)}catch(e){throw new Error(e)}}))));t.getProfile=d;const u=(0,s.default)(((e,t)=>n(void 0,void 0,void 0,(function*(){if(!e.user)throw new Error("Unauthorized request!");const{_id:r}=e.user;(0,a.default)(r);const{firstName:n,lastName:o,email:s,mobile:d}=e.body;try{const e=[];if(s&&((yield i.default.findOne({_id:r,email:s}))?e.push("Email already in use!"):(yield i.default.findOne({_id:{$ne:r},email:s}))&&e.push("Email already exists!")),d&&((yield i.default.findOne({_id:r,mobile:d}))?e.push("Mobile already in use!"):(yield i.default.findOne({_id:{$ne:r},mobile:d}))&&e.push("Mobile no. already exists!")),e.length>0)throw new Error(e.join(", "));const a=yield i.default.findOneAndUpdate({_id:r},Object.assign(Object.assign(Object.assign(Object.assign({},n&&{firstName:n}),o&&{lastName:o}),s&&{email:s}),d&&{mobile:d}),{new:!0}).select("-password");if(!a)throw new Error("User doesn't exist");t.send(a)}catch(e){throw new Error(e)}}))));t.updateProfile=u},529:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAdmin=t.authMiddleware=void 0;const i=o(r(909)),s=o(r(344)),a=o(r(776)),d=(0,a.default)(((e,t,r)=>n(void 0,void 0,void 0,(function*(){var t;let n;if(!(null===(t=e.headers.authorization)||void 0===t?void 0:t.startsWith("Bearer")))throw new Error("No Access token received");n=e.headers.authorization.split(" ")[1];try{if(n){const t=s.default.verify(n,process.env.JWT_SECRET||"");if("string"==typeof t)throw new Error("Invalid Access Token");const o=yield i.default.findById(null==t?void 0:t.id);if(!o)throw new Error("User not found");e.user=o,r()}}catch(e){throw new Error("Unauthrized: token expired plz login again")}}))));t.authMiddleware=d;const u=(0,a.default)(((e,t,r)=>n(void 0,void 0,void 0,(function*(){try{if(!e.user)throw new Error("No user received!");const{email:t}=e.user;try{const e=yield i.default.findOne({email:t});if(e&&"admin"!==e.role)throw new Error("You are not an admin user");r()}catch(e){throw new Error(e)}}catch(e){throw new Error(e)}}))));t.isAdmin=u},394:function(e,t){var r=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandler=t.notFound=void 0,t.notFound=(e,t,r)=>{const n=new Error(`Not Found: ${e.originalUrl}`);t.status(404),r(n)},t.errorHandler=(e,t,n,o)=>{const i=200===n.statusCode?500:n.statusCode;n.status(i);const{name:s,message:a}=e,d=r(e,["name","message"]);n.json({status:i,name:s,message:a,details:Object.assign({},d)})}},909:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(185)),s=o(r(96)),a=new i.default.Schema({firstName:{type:String,required:!0,min:[3,"FirstName can't be less than 3 characters"]},lastName:{type:String,min:[3,"LastName can't be less than 3 characters"]},email:{type:String,required:!0,unique:!0,validate(e){if(!e.match(/^[\w-\\.]+@([\w-]+\.)+[\w-]{2,4}$/))throw new Error("Invalid email address")}},mobile:{type:String,required:!0,unique:!0,validate(e){if(!e.match(/^[0-9]{10}$/))throw new Error("Invalid mobile number")}},password:{type:String,required:!0,min:[5,"Password must at least 5 characters long!"]},role:{type:String,enum:{values:["user","admin"],message:"role '{VALUE}' not supported!"},default:"user"}});a.pre("save",(function(){return n(this,void 0,void 0,(function*(){const e=yield s.default.genSalt(10);this.password=yield s.default.hash(this.password,e)}))})),a.methods.isPasswordMatched=function(e){return n(this,void 0,void 0,(function*(){return yield s.default.compare(e,this.password)}))},t.default=i.default.model("User",a)},582:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(860)),i=r(558),s=r(529),a=o.default.Router();a.get("/profile/:id",s.authMiddleware,s.isAdmin,i.getProfile),a.delete("/profile/:id",s.authMiddleware,s.isAdmin,i.deleteProfile),a.put("/profile/:id",s.authMiddleware,s.isAdmin,i.updateProfile),t.default=a},966:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(860)),i=r(739),s=o.default.Router();s.post("/register",i.createUser),s.post("/login",i.loginUser),t.default=s},437:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(860)),i=r(438),s=r(529),a=o.default.Router();a.get("/profile",s.authMiddleware,i.getProfile),a.put("/profile",s.authMiddleware,i.updateProfile),t.default=a},396:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(185));t.default=e=>{if(!o.default.Types.ObjectId.isValid(e))throw new Error("This id is not valid or not found")}},96:e=>{e.exports=require("bcrypt")},986:e=>{e.exports=require("body-parser")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},776:e=>{e.exports=require("express-async-handler")},344:e=>{e.exports=require("jsonwebtoken")},185:e=>{e.exports=require("mongoose")}},t={};!function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(752)})();